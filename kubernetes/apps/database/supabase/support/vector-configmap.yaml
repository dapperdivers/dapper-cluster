---
apiVersion: v1
kind: ConfigMap
metadata:
  name: supabase-vector-config
  namespace: database
data:
  vector.yaml: |
    api:
      enabled: true
      address: "127.0.0.1:8686"
      playground: false

    sources:
      supabase_logs:
        type: "http_server"
        address: "0.0.0.0:9001"
        encoding: "json"

    transforms:
      supabase_filter:
        type: "filter"
        inputs: ["supabase_logs"]
        condition:
          type: "vrl"
          source: |
            .timestamp != null

    sinks:
      supabase_analytics:
        type: "http"
        inputs: ["supabase_filter"]
        uri: "http://localhost:4000/api/logs"
        method: "post"
        encoding:
          codec: "json"
        headers:
          Content-Type: "application/json"
