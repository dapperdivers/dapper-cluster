---
apiVersion: v1
kind: ConfigMap
metadata:
  name: tdarr-patch-script
  namespace: media
data:
  patch.sh: |
    #!/bin/sh
    echo "Patching Tdarr server to remove 5 node limit..."

    # Backup original file
    cp /app/Tdarr_Server/srcug/api/nodeRelay/nodeRelay.js /app/Tdarr_Server/srcug/api/nodeRelay/nodeRelay.js.original 2>/dev/null || true

    # Apply patch - change limit from 5 (0x5) to 999 (0x3e7)
    sed -i 's/>=0x5&&y/>=0x3e7&&y/g' /app/Tdarr_Server/srcug/api/nodeRelay/nodeRelay.js

    # Verify patch was applied
    if grep -q "0x3e7" /app/Tdarr_Server/srcug/api/nodeRelay/nodeRelay.js; then
      echo "✅ Patch applied successfully - node limit increased to 999"
    else
      echo "❌ Patch failed - using original file"
    fi
