---
# ConfigMap with Wazuh configuration files
# These would normally come from the wazuh-kubernetes repo
# but we're inlining for GitOps simplicity
apiVersion: v1
kind: ConfigMap
metadata:
  name: wazuh-config
data:
  # Indexer config
  opensearch.yml: |
    network.host: 0.0.0.0
    node.name: wazuh-indexer
    cluster.name: wazuh-cluster
    discovery.type: single-node
    plugins.security.ssl.http.enabled: false
    plugins.security.disabled: true
    compatibility.override_main_response_version: true
  
  # Dashboard config - no auth (indexer has security disabled)
  opensearch_dashboards.yml: |
    server.host: 0.0.0.0
    server.port: 5601
    server.ssl.enabled: false
    opensearch.hosts: http://wazuh-indexer:9200
    opensearch.ssl.verificationMode: none
    # Disable security plugin to match indexer
    securityDashboards.disabled: true
    uiSettings.overrides.defaultRoute: /app/wazuh
  
  # Wazuh app config - API connection
  # Note: Password will need to be set in the UI on first login
  # or via the wazuh-dashboard secret below
  wazuh.yml: |
    hosts:
      - default:
          url: http://wazuh-manager
          port: 55000
          username: wazuh-wui
          password: changeme
          run_as: false
  
  # Manager ossec.conf basics
  ossec.conf: |
    <ossec_config>
      <global>
        <jsonout_output>yes</jsonout_output>
        <alerts_log>yes</alerts_log>
        <logall>no</logall>
        <logall_json>no</logall_json>
        <email_notification>no</email_notification>
      </global>
      
      <alerts>
        <log_alert_level>3</log_alert_level>
        <email_alert_level>12</email_alert_level>
      </alerts>

      <vulnerability-detection>
        <enabled>yes</enabled>
        <index-status>yes</index-status>
        <feed-update-interval>60m</feed-update-interval>
      </vulnerability-detection>
    </ossec_config>
