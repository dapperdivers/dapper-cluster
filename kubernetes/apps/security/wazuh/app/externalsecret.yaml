---
# yaml-language-server: $schema=https://kube-schemas.pages.dev/external-secrets.io/externalsecret_v1beta1.json
# ExternalSecret to pull Wazuh passwords from Infisical
#
# You need to create these secrets in Infisical first:
#   - WAZUH_INDEXER_PASSWORD: Admin password for OpenSearch (24+ chars, complex)
#   - WAZUH_API_PASSWORD: API password (must meet Wazuh complexity requirements)
#   - WAZUH_DASHBOARD_PASSWORD: Dashboard kibanaserver password
#
# Wazuh password requirements:
#   - Minimum 8 characters
#   - At least one uppercase letter
#   - At least one lowercase letter
#   - At least one number
#   - At least one special character (!@#$%^&*)
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: wazuh-passwords
spec:
  secretStoreRef:
    name: infisical
    kind: ClusterSecretStore
  refreshInterval: 1h
  target:
    name: wazuh-passwords
    template:
      engineVersion: v2
      data:
        indexer-password: "{{ .WAZUH_INDEXER_PASSWORD }}"
        api-password: "{{ .WAZUH_API_PASSWORD }}"
        dashboard-password: "{{ .WAZUH_DASHBOARD_PASSWORD }}"
  data:
    - secretKey: WAZUH_INDEXER_PASSWORD
      remoteRef:
        key: WAZUH_INDEXER_PASSWORD
    - secretKey: WAZUH_API_PASSWORD
      remoteRef:
        key: WAZUH_API_PASSWORD
    - secretKey: WAZUH_DASHBOARD_PASSWORD
      remoteRef:
        key: WAZUH_DASHBOARD_PASSWORD
