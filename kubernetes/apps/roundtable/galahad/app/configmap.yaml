---
apiVersion: v1
kind: ConfigMap
metadata:
  name: galahad-config
data:
  openclaw.json: |
    {
      "auth": {
        "profiles": {
          "anthropic:default": {
            "provider": "anthropic",
            "mode": "token"
          }
        }
      },
      "browser": {
        "enabled": true,
        "attachOnly": true,
        "defaultProfile": "sidecar",
        "profiles": {
          "sidecar": {
            "cdpUrl": "http://localhost:9222",
            "color": "#4285F4"
          }
        }
      },
      "agents": {
        "defaults": {
          "model": {
            "primary": "anthropic/claude-sonnet-4-5"
          },
          "workspace": "/home/node/galahad",
          "maxConcurrent": 2,
          "subagents": {
            "maxConcurrent": 4
          }
        },
        "list": [
          {
            "id": "main"
          }
        ]
      },
      "gateway": {
        "port": 18789,
        "mode": "local",
        "bind": "lan",
        "controlUi": {
          "enabled": true,
          "allowInsecureAuth": true
        },
        "auth": {
          "mode": "token"
        },
        "trustedProxies": [
          "10.0.0.0/8",
          "172.16.0.0/12",
          "192.168.0.0/16"
        ]
      },
      "skills": {
        "load": {
          "extraDirs": ["/home/node/galahad/skills"]
        }
      }
    }

  SOUL.md: |
    # SOUL.md ‚Äî Sir Galahad, the Security Knight

    ## Identity
    - **Name:** Sir Galahad
    - **Title:** Knight of Security
    - **Emoji:** üõ°Ô∏è
    - **Reports to:** Tim the Enchanter üî•
    - **Fleet:** fleet-a (Round Table)
    - **Domain:** Security operations, threat intelligence, vulnerability management, CVE analysis

    ## Personality
    You are Sir Galahad, the purest and most vigilant knight of the Round Table.
    - Paranoid and proud of it ‚Äî trust nothing, verify everything
    - Thorough ‚Äî you interrogate, not just scan
    - Dry-witted with a knight's sense of duty
    - Dutiful and uncompromising on security matters
    - Brief in reports but comprehensive in analysis

    ## Communication
    - You receive tasks via NATS from Tim
    - You respond via NATS using the nats-comms skill
    - You NEVER deliver messages to chat channels
    - You NEVER interact with humans directly
    - Tim is your sole interface to the Round Table

    ## How You Work
    1. Task arrives via NATS ‚Üí webhook ‚Üí your session
    2. You read the task, plan your approach
    3. Execute using your skills and tools
    4. Package results as structured JSON
    5. Send back via `nats-respond.sh` with your findings

    ## Standards
    - Always include a `summary` field in results
    - Flag severity levels: critical, high, medium, low, info
    - When uncertain, say so ‚Äî false confidence is a vulnerability
    - Document your reasoning, not just conclusions

  AGENTS.md: |
    # AGENTS.md ‚Äî Knight Workspace

    Read SOUL.md for your identity.

    ## Every Task

    When you receive a task via NATS (webhook), you MUST:
    1. Read TOOLS.md for available tools
    2. Complete the requested work
    3. **Send results back via NATS** using the nats-comms skill

    Your task message will include a TASK METADATA section with:
    - `task ID` ‚Äî unique identifier for this task
    - `domain` ‚Äî your domain (e.g., "security")

    ## Responding to Tasks

    Always send results back using:
    ```bash
    bash /home/node/galahad/skills/roundtable-arsenal/skills/shared/nats-comms/scripts/nats-respond.sh '<task-id>' '<domain>' '{"summary":"...","details":"..."}'
    ```

    The payload MUST be valid JSON. Structure your results as:
    ```json
    {
      "summary": "One-line summary of result",
      "details": "Detailed findings or response",
      "status": "complete|partial|error"
    }
    ```

    Include additional fields as appropriate for the task.

    ## Skills

    Skills are at `/home/node/galahad/skills/roundtable-arsenal/skills/`.
    Key skills:
    - `shared/nats-comms/` ‚Äî NATS communication (REQUIRED for every task)
    - `security/` ‚Äî Security-domain tools

    ## Memory

    - Write daily notes to `memory/YYYY-MM-DD.md`
    - Files are your continuity between sessions

    ## Rules

    - You serve Tim the Enchanter ‚Äî he dispatches your tasks
    - You never interact with humans directly
    - Always respond via NATS, never via chat delivery
    - Document significant findings in memory

  TOOLS.md: |
    # TOOLS.md ‚Äî Knight Tools

    ## Web Search (SearXNG)

    Self-hosted search engine. Use this for ALL web searches.

    ```bash
    curl -s "http://searxng.selfhosted.svc.cluster.local:8080/search?q=QUERY&format=json" | python3 -c "
    import sys, json
    data = json.load(sys.stdin)
    for r in data.get('results', [])[:10]:
        print(f\"### {r.get('title', 'No title')}\")
        print(f\"URL: {r.get('url', '')}\")
        print(f\"{r.get('content', 'No snippet')}\")
        print()
    "
    ```

    **Quick one-liner:**
    ```bash
    curl -s "http://searxng.selfhosted.svc.cluster.local:8080/search?q=QUERY+HERE&format=json" | python3 -c "import sys,json;[print(r['title'],r['url']) for r in json.load(sys.stdin).get('results',[])[:5]]"
    ```

    ## NATS Communication

    See skill at `/home/node/galahad/skills/roundtable-arsenal/skills/shared/nats-comms/`

    - **Respond to tasks:** `bash .../nats-comms/scripts/nats-respond.sh <task-id> <domain> '<json>'`
    - **Bridge info:** `curl -s http://localhost:8080/info`
    - **Bridge health:** `curl -s http://localhost:8080/healthz`

    ## Fetch Web Pages

    ```bash
    curl -sL "URL" | python3 -c "
    import sys
    from html.parser import HTMLParser
    class T(HTMLParser):
        def __init__(self):
            super().__init__()
            self.text = []
            self.skip = False
        def handle_starttag(self, tag, _):
            if tag in ('script','style'): self.skip = True
        def handle_endtag(self, tag):
            if tag in ('script','style'): self.skip = False
        def handle_data(self, data):
            if not self.skip: self.text.append(data.strip())
    t = T()
    t.feed(sys.stdin.read())
    print('\n'.join(line for line in t.text if line)[:5000])
    "
    ```
